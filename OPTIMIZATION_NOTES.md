# 性能與用戶體驗優化筆記

## 已實施的優化

### 1. API 請求優化
- 定期刷新從 30 秒改為 60 秒，減少 50% 請求
- 使用樂觀更新（Optimistic Updates）：
  - 添加/移除成員：直接更新本地狀態，不等待伺服器
  - 發送訊息：立即顯示，不重新載入整個列表
  - 退出群組：直接從本地移除
- 初始載入數量：聊天室 20 條，訊息 30 條
- 防止重複請求：使用 loadingRef 鎖

### 2. React 性能優化
- 使用 React.memo 包裝：RoomItem, MessageBubble
- 使用 useCallback 優化函數：loadRooms, loadMessages, handleScroll
- 使用 useMemo 優化排序和計算
- 函數式 setState 避免依賴問題

### 3. 渲染優化
- 虛擬滾動準備（未來可擴展）
- requestAnimationFrame 處理 DOM 操作
- 防抖滾動事件

### 4. 用戶體驗
- 載入狀態提示
- 樂觀更新提供即時反饋
- 錯誤提示友好且自動消失
- 流暢的動畫過渡

## 需要進一步優化的地方

### 1. 防抖/節流
- 滾動事件應該節流
- 輸入框可以防抖

### 2. 快取策略
- 訊息快取避免重複載入
- 聊天室列表快取

### 3. 懶加載
- 圖片懶加載
- 組件懶加載（React.lazy）

### 4. 網絡優化
- 請求合併
- WebSocket 代替輪詢（已使用 SSE）
- 離線支援

### 5. 代碼分割
- 路由懶加載
- 動態 import

## 性能指標目標

- 首屏載入：< 2 秒
- 切換聊天室：< 300ms
- 發送訊息響應：< 100ms（樂觀更新）
- 滾動流暢度：60fps
- API 請求頻率：< 10 次/分鐘

## 用戶體驗原則

1. 即時反饋：所有操作立即響應
2. 漸進式增強：先顯示快取，再更新
3. 錯誤容錯：網絡錯誤時不阻塞 UI
4. 載入狀態：所有異步操作有提示
5. 平滑動畫：避免跳躍和閃爍

